# Malware

### Contents
[Why Is Malware a Problem?](#why-is-malware-a-problem)

[What Is Malware?](#what-is-malware)

[Types of Malware](#types-of-malware)

[Defense Against Malware](#defense-against-malware)

[Playgrounds](#playgrounds)

*[Back](../week6-malware#week-6---malware)*


## Why Is Malware a Problem?
- Proliferation of misunderstandings and misconceptions regarding malware
- Increasing sophistication of malware
- Lack of focus on securing systems (e.g. IoT devices)


## What Is Malware?
__Malware__: Malicious software. Types of malware include viruses, worms, 
backdoors, trojan horses, rootkits, and ransomware.

__Zombie__: An infected and compromised machine or computing device.

__Botnet__: A network of infected machines. Often used for performing DDoS
attacks.

__Bot herder / master__: Attacker(s) controlling a botnet

__Command and Control (C&C)__: Infrastructure (e.g. servers, software) for
controlling malware and botnets.


## Types of Malware

### Virus ###
__Virus__: A malicious piece of executable code that replicates itself by 
attaching to host files. A virus can be an executable, a script, a document 
containing a macro, a boot sector of a disk partition, etc.

*Virus Techniques*

1. Lays dormant, attached to a host file.
2. Dormant virus is shared when infected host file is shared.
3. Once host file is activated (e.g. opened), the virus activates and 
   replicates to files and disks on your system. (Note: a replicated virus
   does not need to be an exact copy of itself).

### Worm ###
__Worm__: A standalone malicious piece of executable code that replicates 
itself by sending copies of itself over a network. Worms do not require host 
files to propagate.

*Worm Techniques*

1. Scans and selects random IPv4 addresses
2. Sends itself to the addresses in small packets to reduce suspicion
3. Connects to vulnerable network services using remote commands (e.g.
   `rsh`) to enter vulnerable sockets.
4. Exploits vulnerabilities (e.g. via password cracking). May open a shell.

> __Morris Worm__. The Morris Worm consisted of 99 lines of code and brought
  down the internet in November 1988. The worm would connect to another
  computer, find and use one of several vulnerabilities (e.g. buffer overflow in
  `fingerd`, password cracking, etc.) to copy itself to that second computer.
  The worm would use the Sendmail bug to execute the worm and would use `rsh`
  and password cracking to break into the user account, harvesting addresses for
  other remote machines from the `.rhosts` file. Due to a mistake, the original
  code and the copy would repeat their actions in an infinite loop to all other
  computers on the ARPANET.

> __Code Red__. Code Red was a worm that exploited a bug in MS IIS to penetrate
  and spread. In days 1 - 19, the worm probed random IPs for systems running
  IIS. It defaced websites with the statement "Hacked by Chinese!". In days 20 -
  29, it set up trigger time for DoS attacks, infecting 360,000 servers in 14
  hours in its second wave.

> __Slammer__. Slammer was a random scanning worm that exploited a bugger
  overflow bug on machines running Microsoft SQL 2000 servers. It infected most
  of the IPv4 internet in 10 minutes.

###  Trojan Horse
__Trojan Horse__: A seemingly useful program that contains malicious code.
- Can perform both over and covert actions.
- Payload can be anything (e.g. keylogger, spyware, etc.).

### Backdoor
__Backdoor__: A program that bypasses authentication and grants an attacker
access to a remote machine (connecting via netcat or via a malware kit (e.g.
Mpack)).

> __`tini`__. An assembly-program, `tini` was a 3 kb backdoor for Windows. It
  listens at TCP port 7777 and gives anybody who connect to the port a remote
  Command Prompt. Usage: install `tini.exe` on a Windows target machine and open
  it. On the attacking machine, connect to the target using netcat: `nc
  <IP_OF_TARGET> 7777`. Source:
  [ntsecurity.nu](http://ntsecurity.nu/toolbox/tini/). NOTE: will be flagged by
  most anti-virus software.

### Rootkit
__Rootkit__: A malicious program that acquires and maintains privileged access
to the OS while hiding its presence. Three goals of a rootkit:
1. Run - To run without restriction on a target computer.
2. Hide - To appear invisible to all other applications on the machine.
3. Act - To perform malicious actions (e.g. stealing passwords).

List of known rootkits:
[bleepingcomputer.com](https://www.bleepingcomputer.com/startups/rootkits/)

Source:
[symantec.com](http://www.symantec.com/content/en/us/enterprise/media/security_response/whitepapers/rootkits.pdf)


### Ransomware
__Ransomware__: A piece of software that holds or locks a target machine until
the user pays a ransom. A relatively new kind of malware (circa 2012).

> __WannaCry__. WannaCry took advantage of the EternalBlue SMB vulnerability
  (of which was found from leaked NSA exploits) in order to infect Windows
  machines and to propagate to other machines on the network. Infected machines
  were held ransom for $300 in bitcoins.


## Defense Against Malware
- Do not interact with untrusted sources
- Check the checksums of software downloads
- Securely wipe your system every so often (defends against rootkits)
- Scan your system for suspicious open ports / software behaviors
- Detect for program changes
- Patch operating systems and applications as soon as possible
- Detect intrusions
- Advanced -- white-list / block certain behaviors

### Tools
- [RootkitRevealer](https://docs.microsoft.com/en-us/sysinternals/downloads/rootkit-revealer) - Unmaintained rootkit detector for Windows XP and Windows Server 
2003 (32-bit).
- [Carbon Black](https://www.carbonblack.com/) - Identifies potential attacks,
  threats, and malware at endpoints.
- [Tripwire](https://www.tripwire.com/) - Detects threats and vulnerabilities 
on a system.
- [VirusTotal](https://www.virustotal.com/) - Free online service that analyzes
  suspicious files and URLS. Facilitates the quick detection of viruses, worms,
  trojans, etc. Maximum file size upload: 128 mb. Acquired by Google.

### The Problem with Anti-Virus Software
- Provide a false sense of security
- Based on signature scanning (more applicable to early viruses)
- Largely reactive
- Modern viruses are polymorphic, stealthy, and encrypted
- Worms can alter DNS software, preventing the infected machines from
  downloading new virus signatures from anti-virus vendors

## Playgrounds
Downloading malware samples allow us to research and learn malware techniques 
and anatomies, thereby allowing us to develop new tools and defenses. Below 
are some sources for malware samples.

- [Open Malware](http://openmalware.org/)
- [Contagio](https://contagiodump.blogspot.com/)
- [MalwareBlacklist](http://www.malwareblacklist.com/showMDL.php)
- [theZoo](https://github.com/ytisf/theZoo)
- [And more...](https://zeltser.com/malware-sample-sources/)

